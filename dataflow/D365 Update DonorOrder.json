{
	"name": "D365 Update DonorOrder",
	"properties": {
		"description": "Contact, MG, Bankdetails",
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "nsridynamicssandox",
						"type": "LinkedServiceReference"
					},
					"name": "donororder"
				},
				{
					"linkedService": {
						"referenceName": "nsridynamicssandox",
						"type": "LinkedServiceReference"
					},
					"name": "transaction"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "nsridynamicssandox",
						"type": "LinkedServiceReference"
					},
					"name": "DonorOrderUpdate"
				}
			],
			"transformations": [
				{
					"name": "joindonorordertransaction"
				},
				{
					"name": "DerivedDonorOrderKey"
				},
				{
					"name": "AlterDonorOrder"
				},
				{
					"name": "DerivedTransactionKey"
				}
			],
			"scriptLines": [
				"source(output(",
				"          cog_donororderid as string,",
				"          cog_paymentmadename as string,",
				"          cog_donationreasonname as string,",
				"          cog_resendname as string,",
				"          cog_upsell as boolean,",
				"          modifiedon as timestamp,",
				"          cog_donororderfromname as string,",
				"          overriddencreatedon as timestamp,",
				"          statuscodename as string,",
				"          cog_dateassigned as timestamp,",
				"          cog_delivery_tax_transname as string,",
				"          cog_balanceamount_base as decimal(38,2),",
				"          cog_totalticketamount_base as decimal(38,0),",
				"          transactioncurrencyidname as string,",
				"          cog_npodoc_tax_transname as string,",
				"          cog_searescuecampaignname as string,",
				"          cog_bankdetailsname as string,",
				"          cog_leadtype as integer,",
				"          cog_followupdate as timestamp,",
				"          cog_testingname as string,",
				"          cog_npodoc_receipt as boolean,",
				"          cog_sendticketsname as string,",
				"          cog_description as string,",
				"          cog_balanceamount as decimal(38,2),",
				"          cog_communicationlanguagename as string,",
				"          cog_campaignname as string,",
				"          cog_totalticketamount_state as integer,",
				"          cog_donationreason as integer,",
				"          cog_accessdb_lnglogno as string,",
				"          cog_sendwelcomepackdate as timestamp,",
				"          statuscode as integer,",
				"          cog_sendwelcomepackname as string,",
				"          cog_contactyominame as string,",
				"          cog_paymentmethodname as string,",
				"          cog_paidamount as decimal(38,0),",
				"          cog_leadtypename as string,",
				"          cog_npodoc_tax_annuallyname as string,",
				"          cog_source as integer,",
				"          cog_ticketamount as decimal(38,0),",
				"          statecodename as string,",
				"          cog_paymenttype as integer,",
				"          exchangerate as decimal(38,10),",
				"          cog_searescuecampaign as integer,",
				"          cog_npodoc_tax_trans as boolean,",
				"          cog_npoadministrationafrikaanstext as string,",
				"          createdon as timestamp,",
				"          cog_cancellreasonname as string,",
				"          cog_paymentmethod as integer,",
				"          cog_ticketamount_base as decimal(38,0),",
				"          cog_administrationaccountyominame as string,",
				"          cog_nameonvessel as string,",
				"          cog_npodoc_sendmethod as integer,",
				"          cog_donotcreatenpodocumentname as string,",
				"          cog_resend as boolean,",
				"          cog_communicationlanguage as integer,",
				"          cog_competition as integer,",
				"          cog_npodoc_equityname as string,",
				"          owneridyominame as string,",
				"          cog_sendpaymentdetails as boolean,",
				"          timezoneruleversionnumber as integer,",
				"          cof_datecancelled as timestamp,",
				"          owningbusinessunitname as string,",
				"          cog_administrationaccountname as string,",
				"          cog_sendpaymentdetailsdate as timestamp,",
				"          cog_npodoc_receiptname as string,",
				"          cog_paymenttypename as string,",
				"          cog_dateconverted as timestamp,",
				"          cog_datasource as integer,",
				"          cog_stationname as string,",
				"          createdonbehalfbyname as string,",
				"          cog_delivery_receipt as boolean,",
				"          owneridtype as string,",
				"          cog_cancellreason as integer,",
				"          cog_delivery_tax_trans as boolean,",
				"          owneridname as string,",
				"          modifiedonbehalfbyname as string,",
				"          cog_contactname as string,",
				"          cog_delivery_equityname as string,",
				"          cog_accessdb_strcompanyname as string,",
				"          cog_npodoc_equity as boolean,",
				"          cog_npodocumentenglishtext as string,",
				"          cog_totalticketamount as decimal(38,0),",
				"          cog_bankreference as string,",
				"          cog_donorleadname as string,",
				"          cog_name as string,",
				"          cog_sendwelcomepack as boolean,",
				"          cog_npoadministrationenglishtext as string,",
				"          cog_donationamount_base as decimal(38,0),",
				"          cog_sendpaymentdetailsname as string,",
				"          cog_datebanked as timestamp,",
				"          cog_paidamount_base as decimal(38,0),",
				"          cog_npodoc_tax_annually as boolean,",
				"          cog_completedonororder as boolean,",
				"          cog_sourcename as string,",
				"          createdonbehalfbyyominame as string,",
				"          cog_noofdonortickets_state as integer,",
				"          cog_noofdonortickets as integer,",
				"          cog_accountname as string,",
				"          cog_donortransactionname as string,",
				"          cog_administeredname as string,",
				"          cog_donationamount as decimal(38,0),",
				"          cog_administrationcontactyominame as string,",
				"          cog_assignticketnumbersname as string,",
				"          cog_datepaid as timestamp,",
				"          cog_delivery_receiptname as string,",
				"          cog_numberoftickets as integer,",
				"          cog_noofdonortickets_date as timestamp,",
				"          cog_donororderfrom as integer,",
				"          cog_createticketrowsname as string,",
				"          cog_donationtype as integer,",
				"          createdbyname as string,",
				"          cog_accountyominame as string,",
				"          modifiedbyyominame as string,",
				"          cog_donationtypename as string,",
				"          cog_administrationcontactname as string,",
				"          modifiedonbehalfbyyominame as string,",
				"          utcconversiontimezonecode as integer,",
				"          cog_sendtickets as boolean,",
				"          cog_upsellname as string,",
				"          cog_assignticketnumbers as boolean,",
				"          importsequencenumber as integer,",
				"          statecode as integer,",
				"          cog_paymentmade as boolean,",
				"          versionnumber as long,",
				"          cog_delivery_equity as boolean,",
				"          cog_npodocumentafrikaanstext as string,",
				"          cog_completedonorordername as string,",
				"          cog_npodoc_sendmethodname as string,",
				"          cog_totalticketamount_date as timestamp,",
				"          modifiedbyname as string,",
				"          createdbyyominame as string,",
				"          cog_administered as boolean,",
				"          cog_competitionname as string,",
				"          cog_donotcreatenpodocument as boolean,",
				"          cog_shutoffdate as timestamp,",
				"          cog_createticketrows as boolean,",
				"          cog_datasourcename as string,",
				"          cog_donorlead as string,",
				"          cog_station as string,",
				"          createdonbehalfby as string,",
				"          cog_administrationcontact as string,",
				"          owninguser as string,",
				"          cog_donortransaction as string,",
				"          cog_bankdetails as string,",
				"          cog_contact as string,",
				"          cog_testing as string,",
				"          modifiedby as string,",
				"          transactioncurrencyid as string,",
				"          cog_administrationaccount as string,",
				"          modifiedonbehalfby as string,",
				"          ownerid as string,",
				"          cog_campaign as string,",
				"          {@odata.etag} as string,",
				"          createdby as string,",
				"          owningbusinessunit as string,",
				"          cog_account as string,",
				"          owningteam as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'dynamics',",
				"     format: 'dynamicsformat',",
				"     entity: 'cog_donororder',",
				"     timeout: 30,",
				"     manifestType: 'model') ~> donororder",
				"source(output(",
				"          cog_donororderid as string,",
				"          cog_paymentmadename as string,",
				"          cog_donationreasonname as string,",
				"          cog_resendname as string,",
				"          cog_upsell as boolean,",
				"          modifiedon as timestamp,",
				"          cog_donororderfromname as string,",
				"          overriddencreatedon as timestamp,",
				"          statuscodename as string,",
				"          cog_dateassigned as timestamp,",
				"          cog_delivery_tax_transname as string,",
				"          cog_balanceamount_base as decimal(38,2),",
				"          cog_totalticketamount_base as decimal(38,0),",
				"          transactioncurrencyidname as string,",
				"          cog_npodoc_tax_transname as string,",
				"          cog_searescuecampaignname as string,",
				"          cog_bankdetailsname as string,",
				"          cog_leadtype as integer,",
				"          cog_followupdate as timestamp,",
				"          cog_testingname as string,",
				"          cog_npodoc_receipt as boolean,",
				"          cog_sendticketsname as string,",
				"          cog_description as string,",
				"          cog_balanceamount as decimal(38,2),",
				"          cog_communicationlanguagename as string,",
				"          cog_campaignname as string,",
				"          cog_totalticketamount_state as integer,",
				"          cog_donationreason as integer,",
				"          cog_accessdb_lnglogno as string,",
				"          cog_sendwelcomepackdate as timestamp,",
				"          statuscode as integer,",
				"          cog_sendwelcomepackname as string,",
				"          cog_contactyominame as string,",
				"          cog_paymentmethodname as string,",
				"          cog_paidamount as decimal(38,0),",
				"          cog_leadtypename as string,",
				"          cog_npodoc_tax_annuallyname as string,",
				"          cog_source as integer,",
				"          cog_ticketamount as decimal(38,0),",
				"          statecodename as string,",
				"          cog_paymenttype as integer,",
				"          exchangerate as decimal(38,10),",
				"          cog_searescuecampaign as integer,",
				"          cog_npodoc_tax_trans as boolean,",
				"          cog_npoadministrationafrikaanstext as string,",
				"          createdon as timestamp,",
				"          cog_cancellreasonname as string,",
				"          cog_paymentmethod as integer,",
				"          cog_ticketamount_base as decimal(38,0),",
				"          cog_administrationaccountyominame as string,",
				"          cog_nameonvessel as string,",
				"          cog_npodoc_sendmethod as integer,",
				"          cog_donotcreatenpodocumentname as string,",
				"          cog_resend as boolean,",
				"          cog_communicationlanguage as integer,",
				"          cog_competition as integer,",
				"          cog_npodoc_equityname as string,",
				"          owneridyominame as string,",
				"          cog_sendpaymentdetails as boolean,",
				"          timezoneruleversionnumber as integer,",
				"          cof_datecancelled as timestamp,",
				"          owningbusinessunitname as string,",
				"          cog_administrationaccountname as string,",
				"          cog_sendpaymentdetailsdate as timestamp,",
				"          cog_npodoc_receiptname as string,",
				"          cog_paymenttypename as string,",
				"          cog_dateconverted as timestamp,",
				"          cog_datasource as integer,",
				"          cog_stationname as string,",
				"          createdonbehalfbyname as string,",
				"          cog_delivery_receipt as boolean,",
				"          owneridtype as string,",
				"          cog_cancellreason as integer,",
				"          cog_delivery_tax_trans as boolean,",
				"          owneridname as string,",
				"          modifiedonbehalfbyname as string,",
				"          cog_contactname as string,",
				"          cog_delivery_equityname as string,",
				"          cog_accessdb_strcompanyname as string,",
				"          cog_npodoc_equity as boolean,",
				"          cog_npodocumentenglishtext as string,",
				"          cog_totalticketamount as decimal(38,0),",
				"          cog_bankreference as string,",
				"          cog_donorleadname as string,",
				"          cog_name as string,",
				"          cog_sendwelcomepack as boolean,",
				"          cog_npoadministrationenglishtext as string,",
				"          cog_donationamount_base as decimal(38,0),",
				"          cog_sendpaymentdetailsname as string,",
				"          cog_datebanked as timestamp,",
				"          cog_paidamount_base as decimal(38,0),",
				"          cog_npodoc_tax_annually as boolean,",
				"          cog_completedonororder as boolean,",
				"          cog_sourcename as string,",
				"          createdonbehalfbyyominame as string,",
				"          cog_noofdonortickets_state as integer,",
				"          cog_noofdonortickets as integer,",
				"          cog_accountname as string,",
				"          cog_donortransactionname as string,",
				"          cog_administeredname as string,",
				"          cog_donationamount as decimal(38,0),",
				"          cog_administrationcontactyominame as string,",
				"          cog_assignticketnumbersname as string,",
				"          cog_datepaid as timestamp,",
				"          cog_delivery_receiptname as string,",
				"          cog_numberoftickets as integer,",
				"          cog_noofdonortickets_date as timestamp,",
				"          cog_donororderfrom as integer,",
				"          cog_createticketrowsname as string,",
				"          cog_donationtype as integer,",
				"          createdbyname as string,",
				"          cog_accountyominame as string,",
				"          modifiedbyyominame as string,",
				"          cog_donationtypename as string,",
				"          cog_administrationcontactname as string,",
				"          modifiedonbehalfbyyominame as string,",
				"          utcconversiontimezonecode as integer,",
				"          cog_sendtickets as boolean,",
				"          cog_upsellname as string,",
				"          cog_assignticketnumbers as boolean,",
				"          importsequencenumber as integer,",
				"          statecode as integer,",
				"          cog_paymentmade as boolean,",
				"          versionnumber as long,",
				"          cog_delivery_equity as boolean,",
				"          cog_npodocumentafrikaanstext as string,",
				"          cog_completedonorordername as string,",
				"          cog_npodoc_sendmethodname as string,",
				"          cog_totalticketamount_date as timestamp,",
				"          modifiedbyname as string,",
				"          createdbyyominame as string,",
				"          cog_administered as boolean,",
				"          cog_competitionname as string,",
				"          cog_donotcreatenpodocument as boolean,",
				"          cog_shutoffdate as timestamp,",
				"          cog_createticketrows as boolean,",
				"          cog_datasourcename as string,",
				"          cog_donorlead as string,",
				"          cog_station as string,",
				"          createdonbehalfby as string,",
				"          cog_administrationcontact as string,",
				"          owninguser as string,",
				"          cog_donortransaction as string,",
				"          cog_bankdetails as string,",
				"          cog_contact as string,",
				"          cog_testing as string,",
				"          modifiedby as string,",
				"          transactioncurrencyid as string,",
				"          cog_administrationaccount as string,",
				"          modifiedonbehalfby as string,",
				"          ownerid as string,",
				"          cog_campaign as string,",
				"          {@odata.etag} as string,",
				"          createdby as string,",
				"          owningbusinessunit as string,",
				"          cog_account as string,",
				"          owningteam as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     store: 'dynamics',",
				"     format: 'dynamicsformat',",
				"     entity: 'cog_donororder',",
				"     timeout: 30,",
				"     manifestType: 'model') ~> transaction",
				"DerivedDonorOrderKey, DerivedTransactionKey join(DonorOrderKey == TransactionKey,",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joindonorordertransaction",
				"donororder derive(DonorOrderKey = cog_bankdetails+toString(cog_competition)+cog_contact+toString(cog_paymentmethod)) ~> DerivedDonorOrderKey",
				"joindonorordertransaction alterRow(updateIf(true())) ~> AlterDonorOrder",
				"transaction derive(TransactionKey = cog_bankdetails+toString(cog_competition)+cog_contact+toString(cog_paymentmethod)) ~> DerivedTransactionKey",
				"AlterDonorOrder sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          cog_donorleadname as string,",
				"          owninguser as string,",
				"          cof_datecancelled as timestamp,",
				"          cog_donationreason as integer,",
				"          cog_paymentmethodname as string,",
				"          cog_ticketamount_base as decimal(38,0),",
				"          cog_npodocumentafrikaanstext as string,",
				"          cog_donotcreatenpodocumentname as string,",
				"          cog_paidamount as decimal(38,0),",
				"          cog_sendpaymentdetails as boolean,",
				"          cog_assignticketnumbers as boolean,",
				"          transactioncurrencyid as string,",
				"          cog_noofdonortickets_state as integer,",
				"          cog_shutoffdate as timestamp,",
				"          cog_donationamount_base as decimal(38,0),",
				"          cog_sendpaymentdetailsdate as timestamp,",
				"          cog_npodoc_sendmethodname as string,",
				"          cog_paymenttype as integer,",
				"          cog_paidamount_base as decimal(38,0),",
				"          cog_delivery_receipt as boolean,",
				"          createdbyname as string,",
				"          cog_administered as boolean,",
				"          cog_sendwelcomepackname as string,",
				"          modifiedbyname as string,",
				"          cog_npodoc_tax_trans as boolean,",
				"          createdonbehalfbyyominame as string,",
				"          cog_sendtickets as boolean,",
				"          statuscodename as string,",
				"          cog_datasource as integer,",
				"          statuscode as integer,",
				"          cog_npodoc_receiptname as string,",
				"          cog_sendticketsname as string,",
				"          createdonbehalfbyname as string,",
				"          cog_administrationcontactname as string,",
				"          ownerid as string,",
				"          cog_contactname as string,",
				"          cog_donationreasonname as string,",
				"          owningteam as string,",
				"          cog_nameonvessel as string,",
				"          cog_name as string,",
				"          cog_npodoc_sendmethod as integer,",
				"          cog_noofdonortickets_date as timestamp,",
				"          cog_leadtypename as string,",
				"          cog_npodocumentenglishtext as string,",
				"          cog_cancellreasonname as string,",
				"          exchangerate as decimal(38,10),",
				"          cog_contactyominame as string,",
				"          cog_administrationaccountname as string,",
				"          cog_testing as string,",
				"          cog_followupdate as timestamp,",
				"          cog_account as string,",
				"          modifiedonbehalfby as string,",
				"          versionnumber as long,",
				"          cog_paymentmade as boolean,",
				"          cog_donortransaction as string,",
				"          cog_administrationaccountyominame as string,",
				"          cog_totalticketamount_state as integer,",
				"          cog_communicationlanguagename as string,",
				"          cog_paymenttypename as string,",
				"          cog_createticketrows as boolean,",
				"          owningbusinessunit as string,",
				"          cog_contact as string,",
				"          cog_stationname as string,",
				"          cog_delivery_tax_transname as string,",
				"          cog_donortransactionname as string,",
				"          cog_sendpaymentdetailsname as string,",
				"          modifiedonbehalfbyname as string,",
				"          cog_delivery_equity as boolean,",
				"          cog_sourcename as string,",
				"          cog_administrationaccount as string,",
				"          importsequencenumber as integer,",
				"          cog_station as string,",
				"          cog_administrationcontact as string,",
				"          createdon as timestamp,",
				"          cog_resendname as string,",
				"          overriddencreatedon as timestamp,",
				"          cog_npodoc_equityname as string,",
				"          cog_bankreference as string,",
				"          utcconversiontimezonecode as integer,",
				"          cog_upsellname as string,",
				"          cog_donororderid as string,",
				"          cog_competition as integer,",
				"          cog_totalticketamount_date as timestamp,",
				"          cog_balanceamount as decimal(38,2),",
				"          cog_balanceamount_base as decimal(38,2),",
				"          cog_donorlead as string,",
				"          cog_donationamount as decimal(38,0),",
				"          cog_completedonororder as boolean,",
				"          cog_npoadministrationafrikaanstext as string,",
				"          cog_npodoc_tax_annuallyname as string,",
				"          cog_source as integer,",
				"          cog_numberoftickets as integer,",
				"          cog_paymentmadename as string,",
				"          cog_administrationcontactyominame as string,",
				"          cog_bankdetails as string,",
				"          cog_accessdb_lnglogno as string,",
				"          cog_ticketamount as decimal(38,0),",
				"          cog_donationtypename as string,",
				"          statecode as integer,",
				"          cog_datasourcename as string,",
				"          owneridyominame as string,",
				"          cog_donationtype as integer,",
				"          statecodename as string,",
				"          cog_donororderfrom as integer,",
				"          cog_accountyominame as string,",
				"          cog_delivery_receiptname as string,",
				"          createdbyyominame as string,",
				"          transactioncurrencyidname as string,",
				"          cog_npodoc_tax_transname as string,",
				"          modifiedon as timestamp,",
				"          cog_paymentmethod as integer,",
				"          cog_cancellreason as integer,",
				"          cog_donotcreatenpodocument as boolean,",
				"          cog_dateconverted as timestamp,",
				"          modifiedby as string,",
				"          cog_npodoc_tax_annually as boolean,",
				"          cog_delivery_tax_trans as boolean,",
				"          cog_sendwelcomepack as boolean,",
				"          cog_delivery_equityname as string,",
				"          cog_bankdetailsname as string,",
				"          cog_leadtype as integer,",
				"          modifiedbyyominame as string,",
				"          cog_searescuecampaignname as string,",
				"          modifiedonbehalfbyyominame as string,",
				"          cog_datebanked as timestamp,",
				"          cog_npodoc_equity as boolean,",
				"          cog_resend as boolean,",
				"          cog_totalticketamount_base as decimal(38,0),",
				"          cog_completedonorordername as string,",
				"          cog_createticketrowsname as string,",
				"          cog_donororderfromname as string,",
				"          cog_npodoc_receipt as boolean,",
				"          createdby as string,",
				"          cog_npoadministrationenglishtext as string,",
				"          owneridname as string,",
				"          cog_datepaid as timestamp,",
				"          cog_administeredname as string,",
				"          cog_communicationlanguage as integer,",
				"          owningbusinessunitname as string,",
				"          cog_testingname as string,",
				"          cog_noofdonortickets as integer,",
				"          cog_searescuecampaign as integer,",
				"          cog_accountname as string,",
				"          cog_dateassigned as timestamp,",
				"          cog_accessdb_strcompanyname as string,",
				"          owneridtype as string,",
				"          cog_campaign as string,",
				"          cog_totalticketamount as decimal(38,0),",
				"          cog_competitionname as string,",
				"          cog_sendwelcomepackdate as timestamp,",
				"          createdonbehalfby as string,",
				"          cog_assignticketnumbersname as string,",
				"          cog_upsell as boolean,",
				"          timezoneruleversionnumber as integer,",
				"          cog_description as string,",
				"          cog_campaignname as string,",
				"          {owninguser@aadobjectid@azureactivedirectoryobjectid} as string,",
				"          {owningteam@aadobjectid_membershiptype@azureactivedirectoryobjectid} as string,",
				"          {owningteam@aadobjectid_membershiptype@membershiptype} as integer,",
				"          {cog_testing@cog_trans_do_contact@cog_bankdetails} as string,",
				"          {cog_testing@cog_trans_do_contact@cog_contact} as string,",
				"          {cog_testing@cog_trans_do_contact@cog_division} as integer,",
				"          {cog_testing@cog_trans_do_contact@cog_paymentmethod} as integer,",
				"          {cog_account@cog_no@cog_erpvendornumber} as string,",
				"          {modifiedonbehalfby@aadobjectid@azureactivedirectoryobjectid} as string,",
				"          {cog_donortransaction@cog_trans_do_contact@cog_bankdetails} as string,",
				"          {cog_donortransaction@cog_trans_do_contact@cog_contact} as string,",
				"          {cog_donortransaction@cog_trans_do_contact@cog_division} as integer,",
				"          {cog_donortransaction@cog_trans_do_contact@cog_paymentmethod} as integer,",
				"          {cog_administrationaccount@cog_no@cog_erpvendornumber} as string,",
				"          {modifiedby@aadobjectid@azureactivedirectoryobjectid} as string,",
				"          {createdby@aadobjectid@azureactivedirectoryobjectid} as string,",
				"          {createdonbehalfby@aadobjectid@azureactivedirectoryobjectid} as string",
				"     ),",
				"     store: 'dynamics',",
				"     format: 'dynamicsformat',",
				"     entity: 'cog_donororder',",
				"     timeout: 30,",
				"     deletable: false,",
				"     insertable: false,",
				"     updateable: true,",
				"     upsertable: false,",
				"     mapColumn(",
				"          cog_donororderid = donororder@cog_donororderid,",
				"          cog_transaction = transaction@transactioncurrencyid",
				"     )) ~> DonorOrderUpdate"
			]
		}
	}
}